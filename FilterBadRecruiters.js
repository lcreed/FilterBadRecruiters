//  code broken with function change.  rewriting from scratch